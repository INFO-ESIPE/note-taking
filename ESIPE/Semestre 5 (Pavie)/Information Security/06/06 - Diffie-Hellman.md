[[Information Security]]
23/10/2024
****
For the exam, one is expected to understand the steps composing the Diffie-Hellman exchange.

**Useful :** 
Diffie-Hellman Key Exchange : https://www.youtube.com/watch?v=NmM9HA2MQGI
Diffie-Hellman Mathematics : https://www.youtube.com/watch?v=Yjrfm_oRO0w
****

The purpose of Diffie-Hellman is to **securely share a symmetric key over an insecure channel**
	*This symmetric key, once exchanged, can then be used to exchange other keys, or encrypt messages*

We obviously do not directly share the key in clear text over the network. Instead, each side will exchange public variables and combine those to private variables it generated and never shared. When each side assembles his private variable with the public variables from the other side, they **should obtain the same symmetric key**.


An **active adversary** — which is conventionally called Darth — can read and manipulate anything that is exchanged between **User A (Alice)** and **User B (Bob)**.
A **passive adversary** — which is conventionally called **Oscar** — can only read (sniff) it.


****
## Diffie-Hellman demonstration

We will illustrate a Diffie-Hellman key exchange between Alice and Bob. **Anything that is exchanged between them via the network is visible to Oscar** :

1. When the handshake between the two sides, both parties agree on two **public** values :
	- A very large prime number `n`
		*A big value is required to guarantee good security. `n` must be between 2 Kb and 4 Kb long*
	- A generator `g` (usually a small integer)

2. Each side now generates a **"private key"**, which is a secret and large number they will keep for themselves (these values must never be shared on the network, only kept locally)
	*This value is between 1 and `n`. Since `n` is large, the private key will often end up being a very large value as well.*

4. Each side combines the public values (`n` and `g`) with the private key they generated. This way, they obtain their respective **public key**.
	Mathematically speaking, this process is non-reversible. If this public key is shared, a man-in-the-middle can not retrieve private keys out of it, even though he is aware of the public values agreed on at the beginning of the exchange
		*Think of it as a mixture of colours. You cannot know if a shade of orange is 50% yellow and 50% red, it has subtle variations of quantity that can not be retrieved like that.*

	The formula applied is :
	![[publickey.png]]

4. Each side forwards his public key to the other
	We obtain the following state of the exchange :
	![[pubickey_viz.png]]
	*`g`, `n`, `ag` and `bg` are visible by anyone sniffing the traffic so far; `a` and `b` (secret key generated by each side) remain private*

5. Each side will now privately merge their private key with the other person's public key
	*For alice: Merge her private key `a` with bob's public key`bg`
	For bob: Merge his private key `b` with alice's public key`ag`*

	The formula applied is :
	![[secret.png]]
	
	By doing so, **they will retrieve the exact same value `abg`**. This value will be known by each side, even though it was never clearly exchanged in clear text on the network 
		*It was mathematically computed*

	We obtain the following state of the exchange :
	![[secret_viz.png]]


6. Each side can now use this computed value `abg` as a symmetric key that can encrypt their communications.


Oscar can not retrieve `a` nor `b` even though he does possess a lot of clear text information. No computer can — so far — solve a **discrete logarithm problem**, so this Diffie-Hellman exchange method is safe to use.
	*If a quantum computer could one day be performant enough to efficiently retrieve the private keys, we would be in a big mess really*

****
## MITM

Diffie-Hellman is **secured against passive MITM attacks**. The adversary observing the communications is never able to recover the key, as has missing information.
However, **it is vulnerable to active MITM attacks** — which can occur if the adversary establishes the DE procedure with Alice and pretends to be Bob.
	There is no **mutual authentication** (Alice is sure that she is talking to Bob, and likewise) that mitigates this issue*


MITM attacks are extremely common in the wild
	*Mail delivery, Proxies, Routers, TOR Network ...*

